<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>renderers/dom/dom.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Card.html">Card</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Card.html#calculateYPosition">calculateYPosition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Card.html#computeFonts">computeFonts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Card.html#computeGradients">computeGradients</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Card.html#computeLayers">computeLayers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Card.html#getLayerValue">getLayerValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Card.html#render">render</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardKit.html">CardKit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#_configureOptions">_configureOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#_isValidConfiguration">_isValidConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#_isValidLayoutsConfiguration">_isValidLayoutsConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#_isValidRenderer">_isValidRenderer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#_isValidTemplatesConfiguration">_isValidTemplatesConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#_isValidThemesConfiguration">_isValidThemesConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#addRenderer">addRenderer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#computeConfiguration">computeConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#getRenderers">getRenderers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKit.html#updateConfiguration">updateConfiguration</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardKitDOM.html">CardKitDOM</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitDOM.html#_isValidElement">_isValidElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitDOM.html#download">download</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitDOM.html#renderCard">renderCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitDOM.html#renderUI">renderUI</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitDOM.html#rerender">rerender</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CardKitServer.html">CardKitServer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitServer.html#renderToImage">renderToImage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CardKitServer.html#renderToString">renderToString</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SVGToImage.html">SVGToImage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SVGToImage.html#_inlineImages">_inlineImages</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SVGToImage.html#_isExternal">_isExternal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SVGToImage.html#_isValidElement">_isValidElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SVGToImage.html#_toDataURI">_toDataURI</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SVGToImage.html#download">download</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">renderers/dom/dom.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Dependencies
const React = require("react");
const ReactDOM = require("react-dom");
const Card = require("../shared/Card");
const CardKitRenderer = require("../shared/base");
const UI = require("./ui/ui");
const SVGToImage = require("./SVGToImage");
const { slugify } = require("../../helpers");

/**
 * @name CardKitDOM
 * @class Additional CardKit class used for rendering in the DOM
 */
class CardKitDOM extends CardKitRenderer {
  /**
   * Constructor takes in an instance of CardKit and stores it for later use
   *
   * @param {CardKit} cardkit - An instance of CardKit
   */
  constructor(cardkit) {
    // Ensure we're operating in a browser environment
    if (typeof document === "undefined") {
      throw new Error("CardKitDOM can only be used in a browser environment");
    }

    super(cardkit);

    // Store render IDs
    this.renderedCardID = null;
    this.renderedUIID = null;
  }

  /**
   * Renders the built-in UI to the supplied element
   *
   * @param {string} id - The ID of the element to render the UI into
   */
  renderUI(id) {
    if (!this._isValidElement(id)) {
      throw new Error("Invalid element ID provided");
    }

    const element = document.getElementById(id);

    const template = this.cardkit.templates
      ? Object.keys(this.cardkit.templates)[0]
      : false;
    const theme = this.cardkit.themes
      ? Object.keys(this.cardkit.themes)[0]
      : false;
    const layout = this.cardkit.layouts
      ? Object.keys(this.cardkit.layouts)[0]
      : false;

    this.renderedUIID = id;
    ReactDOM.render(
      React.createElement(UI, {
        configuration: this.computeConfiguration({
          template: template,
          theme: theme,
          layout: layout,
        }),
        templates: this.cardkit.templates,
        themes: this.cardkit.themes,
        layouts: this.cardkit.layouts,
        cardKit: this,
      }),
      element
    );
  }

  /**
   * Renders just the Card as a React component to the supplied element
   *
   * @param {string} id - The ID of the element to render the card into
   * @param {object} options - Any override data (e.g. theme, layout) to use when rendering the card
   */
  renderCard(id, options) {
    if (!this._isValidElement(id)) {
      throw new Error("Invalid element ID provided");
    }

    const element = document.getElementById(id);

    this.renderedCardID = id;

    ReactDOM.render(
      React.createElement(Card, {
        configuration: this.computeConfiguration(options),
      }),
      element
    );
  }

  /**
   * Checks if the ID provided is valid
   *
   * @param {string} id - The ID to validate
   * @return {boolean} If the ID was valid
   */
  _isValidElement(id) {
    if (!id) {
      return false;
    }

    const element = document.getElementById(id);
    if (!element) {
      return false;
    }

    return true;
  }

  /**
   * Re-renders the Card or UI
   */
  rerender() {
    if (this.renderedUIID) {
      this.renderUI(this.renderedUIID);
    }

    if (this.renderedCardID) {
      this.renderCard(this.renderedCardID);
    }
  }

  /**
   * Downloads the card as an image in the browser
   *
   * @param {number} scale - The scale to output at
   * @param {object} element - The element to use to generate the image
   */
  download(scale = 2, element) {
    element =
      element.childNodes[0] ||
      document.getElementById(this.renderedCardID).childNodes[0];

    const svgToImage = new SVGToImage(element);

    // Setup default filename
    let filename = "cardkit-default.jpg";

    // Get the configuration
    const configuration = this.computeConfiguration();

    // If there's a layer that has the useAsFilename property, find it
    const filenameLayerKey = Object.keys(configuration.layers).find((key) => {
      const layer = configuration.layers[key];

      return (
        layer.useAsFilename === true &amp;&amp; // Has the useAsFilename property
        layer.hidden !== true &amp;&amp; // Is not hidden
        layer.type === "text"
      ); // Is of type text
    });

    // Get the layer that has the filename on it
    const filenameLayer = configuration.layers[filenameLayerKey];

    // Update the filename
    if (filenameLayer) {
      filename = slugify(filenameLayer.text) + ".jpg";
    }

    // Trigger the download
    svgToImage.download(filename, {
      format: "image/jpeg",
      scale: scale,
    });
  }
}

module.exports = CardKitDOM;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Jun 20 2021 16:41:21 GMT+0100 (British Summer Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
